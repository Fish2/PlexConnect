function selectAudioAndSubs(e,t,n){if(fv=atv.device.softwareVersion.split("."),firmVer=fv[0]+"."+fv[1],parseFloat(firmVer)<fVer)var a='<?xml version="1.0" encoding="UTF-8"?>     <atv>       <head>         <script src="{{URL(/js/selectAudioAndSubs.js)}}"/>       </head>       <body>       <optionDialog id="optionDialog">         <header>           <simpleHeader>             <title>{{TEXT(Select Tracks)}}</title>           </simpleHeader>         </header>         <menu>           <sections>             <menuSection>               <header>                 <horizontalDivider alignment="center">                   <title>{{TEXT(Audio Track)}}</title>                 </horizontalDivider>               </header>               <items>',o="",r="",i="{{TEXT(Subtitle Track)}}",l="center";else var a='<?xml version="1.0" encoding="UTF-8"?>     <atv>       <body>       <popUpMenu id="popUpMenu">         <sections>           <menuSection>             <items>',o="{{TEXT(Audio)}} - ",r="{{TEXT(Subs)}} - ",i="",l="right";for(var m=document.evaluateXPath("//stream"),s=0;s<m.length;++s){var c=m[s];"2"==c.getElementByTagName("streamType").textContent&&(a=a+'                <oneLineMenuItem id="audio'+s.toString()+'" onSelect="selectAudioStream(\''+e+"', '"+t+"', '"+n+"', "+c.getElementByTagName("id").textContent+"); toggleAudioCheck('"+s.toString()+"')\">                 <label>"+o+c.getElementByTagName("language").textContent+" ("+c.getElementByTagName("codec").textContent+")</label>","1"==c.getElementByTagName("selected").textContent&&(a+="                 <accessories>                   <checkMark/>                 </accessories>"),a+="               </oneLineMenuItem>")}a=a+'             </items>           </menuSection>           <menuSection>             <header>               <horizontalDivider alignment="'+l+'">                 <title>'+i+"</title>               </horizontalDivider>             </header>             <items>",a=a+'               <oneLineMenuItem id="sub99" onSelect="selectSubStream(\''+e+"', '"+t+"', '"+n+"', 0); toggleSubCheck('99')\">                 <label>"+r+"{{TEXT(None)}}</label>";for(var d=!0,g=!0,s=0;s<m.length;++s)"3"==m[s].getElementByTagName("streamType").textContent&&(d=!1),"3"==m[s].getElementByTagName("streamType").textContent&&"1"==m[s].getElementByTagName("selected").textContent&&(g=!1);(d||g)&&(a+="                 <accessories>                   <checkMark/>                 </accessories>"),a+="               </oneLineMenuItem>";for(var s=0;s<m.length;++s){var c=m[s];"3"==c.getElementByTagName("streamType").textContent&&(a=a+'               <oneLineMenuItem id="sub'+s.toString()+'" onSelect="selectSubStream(\''+e+"', '"+t+"', '"+n+"', "+c.getElementByTagName("id").textContent+"); toggleSubCheck('"+s.toString()+"')\">                 <label>"+r+c.getElementByTagName("language").textContent+" ("+c.getElementByTagName("format").textContent+")</label>","1"==c.getElementByTagName("selected").textContent&&(a+="                 <accessories>                   <checkMark/>                 </accessories>"),a+="               </oneLineMenuItem>")}if(parseFloat(firmVer)<fVer){a+="                 </items>               </menuSection>             </sections>           </menu>         </optionDialog>       </body>     </atv>";var u=atv.parseXML(a);atv.loadXML(u)}else a+="                 </items>               </menuSection>             </sections>           </popUpMenu>         </body>       </atv>",contextDoc=atv.parseXML(a),atv.contextMenu.load(contextDoc)}function toggleSubCheck(e){if(e="sub"+e,fv=atv.device.softwareVersion.split("."),firmVer=fv[0]+"."+fv[1],parseFloat(firmVer)<fVer)var t=document.rootElement;else var t=contextDoc.rootElement;var n=t.getElementsByTagName("oneLineMenuItem");if(n){for(var a=0;a<n.length;++a){var o=n[a],r=o.getAttribute("id");if(-1!==r.indexOf("sub")){var i=o.getElementByTagName("accessories");i&&i.removeFromParent()}}for(var a=0;a<n.length;++a){var o=n[a],r=o.getAttribute("id");-1!==r.indexOf("sub")&&r==e&&addCheckMark(o)}}}function toggleAudioCheck(e){if(e="audio"+e,fv=atv.device.softwareVersion.split("."),firmVer=fv[0]+"."+fv[1],parseFloat(firmVer)<fVer)var t=document.rootElement;else var t=contextDoc.rootElement;var n=t.getElementsByTagName("oneLineMenuItem");if(n){for(var a=0;a<n.length;++a){var o=n[a],r=o.getAttribute("id");if(-1!==r.indexOf("audio")){var i=o.getElementByTagName("accessories");i&&i.removeFromParent()}}for(var a=0;a<n.length;++a){var o=n[a],r=o.getAttribute("id");-1!==r.indexOf("audio")&&r==e&&addCheckMark(o)}}}function addCheckMark(e){if(fv=atv.device.softwareVersion.split("."),firmVer=fv[0]+"."+fv[1],parseFloat(firmVer)<fVer){var t=document.makeElementNamed("accessories"),n=document.makeElementNamed("checkMark");t.appendChild(n),e.appendChild(t)}else{var t=contextDoc.makeElementNamed("accessories"),n=contextDoc.makeElementNamed("checkMark");t.appendChild(n),e.appendChild(t)}}function selectSubStream(e,t,n,a){var o=e+"/library/parts/"+n+"?subtitleStreamID="+a.toString();""!=t&&(o=o+"&X-Plex-Token="+t);var r=new XMLHttpRequest;r.open("PUT",o,!0),r.send()}function selectAudioStream(e,t,n,a){var o=e+"/library/parts/"+n+"?audioStreamID="+a.toString();""!=t&&(o=o+"&X-Plex-Token="+t);var r=new XMLHttpRequest;r.open("PUT",o,!0),r.send()}atv.Document&&(atv.Document.prototype.getElementById=function(e){var t=this.evaluateXPath("//*[@id='"+e+"']",this);if(t&&t.length>0)return t[0]}),atv.Element&&(atv.Element.prototype.getElementsByTagName=function(e){return this.ownerDocument.evaluateXPath("descendant::"+e,this)},atv.Element.prototype.getElementByTagName=function(e){var t=this.getElementsByTagName(e);if(t&&t.length>0)return t[0]});var fVer=60,contextDoc;