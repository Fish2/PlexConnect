function toggleSettings(e,t){var n="{{URL(/)}}&PlexConnect=SettingsToggle:"+e+"+"+t+"&PlexConnectUDID="+atv.device.udid,a=new XMLHttpRequest;a.open("GET",n,!1),a.send(),doc=a.responseXML;var o=document.getElementById(e).getElementByTagName("rightLabel");if(o){var r=doc.getElementById(e).getElementByTagName("rightLabel");r&&(log("new setting - "+e+"="+r.textContent),o.textContent=r.textContent)}else{mainMenuItem=document.getElementById(e),newMenuItem=doc.getElementById(e);var l=mainMenuItem.getElementByTagName("accessories"),i=newMenuItem.getElementByTagName("accessories");if(l&&l.removeFromParent(),i){accessories=document.makeElementNamed("accessories");var m=document.makeElementNamed("checkMark");accessories.appendChild(m),mainMenuItem.appendChild(accessories)}}}function discover(e,t){gotDiscoverResponse=function(o){var r="{{URL(/)}}&PlexConnect="+t+"&PlexConnectUDID="+atv.device.udid,l=new XMLHttpRequest;l.open("GET",r,!1),l.send(),o=l.responseXML;var i=o.getElementById(e).getElementByTagName("rightLabel");if(i){a.textContent=i.textContent;var m=n.getElementByTagName("accessories").getElementByTagName("spinner");m&&m.removeFromParent(),log("discover done - "+i.textContent)}};var n=document.getElementById(e);if(n){var a=n.getElementByTagName("rightLabel");if(a){if(a.textContent="",!n.getElementByTagName("accessories")){var o=document.makeElementNamed("accessories");n.appendChild(o)}var o=document.makeElementNamed("spinner");n.getElementByTagName("accessories").appendChild(o);var r="{{URL(/)}}&PlexConnect=Discover&PlexConnectUDID="+atv.device.udid,l=new XMLHttpRequest;l.onreadystatechange=function(){try{4==l.readyState&&gotDiscoverResponse(l.responseXML)}catch(e){l.abort()}},l.open("GET",r,!0),l.send()}}}myPlexSignInOut=function(){var e=document.getElementById("MyPlexSignInOut");if(e){getLabel=function(e,t){var n=e.getElementByTagName(t);return n?n.textContent:""},setLabel=function(e,t,n){var a=e.getElementByTagName(t);a||(a=document.makeElementNamed(t),e.appendChild(a)),a.textContent=n},showPict=function(e,t){var n=e.getElementByTagName("accessories");n||(n=document.makeElementNamed("accessories"),e.appendChild(n));var a=document.makeElementNamed(t);n.appendChild(a)},hidePict=function(e,t){var n=e.getElementByTagName("accessories");n&&(n=n.getElementByTagName(t)),n&&n.removeFromParent()},SignIn=function(){var t="",n="";showTextEntryPage=function(e,t,n,a,o,r){var l=new atv.TextEntry;l.type=e,l.title=t,l.instructions=n,l.defaultValue=r,l.defaultToAppleID=!1,l.onSubmit=a,l.onCancel=o,l.show()},gotUsername=function(e){t=e,showTextEntryPage("password","{{TEXT(MyPlex Password)}}","{{TEXT(Enter the MyPlex password for {0}.)}}".format(t),gotPassword,gotCancel,null)},gotPassword=function(e){n=e,doLogin()},gotCancel=function(){hidePict(e,"spinner"),showPict(e,"arrow")},doLogin=function(){var a="{{URL(/)}}&PlexConnect=MyPlexLogin&PlexConnectCredentials="+encodeURIComponent(t+":"+n)+"&PlexConnectUDID="+atv.device.udid,o=new XMLHttpRequest;o.open("GET",a,!1),o.send();var r=o.responseXML,l=r.getElementById("MyPlexSignInOut");l.removeFromParent(),e.parent.replaceChild(e,l);var i=document.getElementById("discover"),l=r.getElementById("discover");l.removeFromParent(),i.parent.replaceChild(i,l);var i=document.getElementById("PlexHomeUser"),l=r.getElementById("PlexHomeUser");l.removeFromParent(),i.parent.replaceChild(i,l);var i=document.getElementById("MyPlexSignInOut");getLabel(i,"rightLabel")?(log("MyPlex Login - done"),updateContextXML()):(setLabel(i,"rightLabel","{{TEXT(Failed)}}"),log("MyPlex Login - failed"))},setLabel(e,"rightLabel",""),hidePict(e,"arrow"),showPict(e,"spinner"),showTextEntryPage("emailAddress","{{TEXT(MyPlex Username)}}","{{TEXT(To sign in to MyPlex, enter your Email address, username or Plex forum username.)}}",gotUsername,gotCancel,null)},SignOut=function(){doLogout=function(){atv.clearInterval(t);var n="{{URL(/)}}&PlexConnect=MyPlexLogout&PlexConnectUDID="+atv.device.udid,a=new XMLHttpRequest;a.open("GET",n,!1),a.send();var o=a.responseXML,r=o.getElementById("MyPlexSignInOut");r.removeFromParent(),e.parent.replaceChild(e,r);var l=document.getElementById("discover"),r=o.getElementById("discover");r.removeFromParent(),l.parent.replaceChild(l,r);var l=document.getElementById("PlexHomeUser"),r=o.getElementById("PlexHomeUser");r.removeFromParent(),l.parent.replaceChild(l,r),log("MyPlex Logout - done"),updateContextXML()},log("Signout"),setLabel(e,"rightLabel",""),hidePict(e,"arrow"),showPict(e,"spinner");var t=atv.setInterval(doLogout,100)};var t=getLabel(e,"rightLabel");""==t||"{{TEXT(Failed)}}"==t?SignIn():SignOut()}},plexHomeUser=function(e){setLabel=function(e,t,n){var a=e.getElementByTagName(t);a||(a=document.makeElementNamed(t),e.appendChild(a)),a.textContent=n};var t=document.getElementById("PlexHomeUser");setLabel(t,"rightLabel","?");var t=document.getElementById("discover");setLabel(t,"rightLabel","Plex Media Servers: ?"),atv.loadURL(e),log("plexHomeUser - done")},atv.onPageUnload=function(e){if("SettingsPage"==e){var t=new XMLHttpRequest;t.open("GET","{{URL(/)}}&PlexConnect=SaveSettings",!1),t.send(),log("Saving Settings file")}};